---
output:
  html_document:
    highlight: textmate
    includes:
      before_body: includes/title.html
    self_contained: yes
    theme: united
    toc: yes
  md_document:
    includes:
      before_body: includes/title.html
    toc: yes
  word_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 9
params:
  local: TRUE
  word: FALSE
  
---
```{r echo = F}
git_commit = "e-sr/SDWirkungNi/blob/master/"
if(params$local){
  html_render = ""
  ipynb_render="http://localhost:8888/notebooks/SDWirkungNi/DSP/"
}else{
  #html_render = paste("https://cdn.rawgit.com/", git_commit,sep = "")
  html_render = "https://rawgit.com/e-sr/SDWirkungNi/master/html/"
  ipynb_render = "http://nbviewer.jupyter.org/github/e-sr/SDWirkungNi/blob/master/DSP/"
}

dw_path = "https://github.com/e-sr/SDWirkungNi/raw/master/"
repo_path = "https://github.com/e-sr/SDWirkungNi/"
```
----

## Einleitung 

Im Rahmen der Projekts Erprobung Schienendämpfer (SD) wurden zwischen Niederwangen und Bümplitz SD eingebaut. Diese Teststrecke diente haupsächlich um Sicherheitsrelevanten infrastrukturseitigen Fragen zu prüfen. Die teststreck besteht aus 2 unterstrecken:

- Niederwangen: Betonschwelle B91,
- Bümpliz: Holzschwellen

in diesem Bericht wird nur den Teil mit Betonschwellen diskutiert. Diesem Teil besteht aus 5 Abschnitten 108m länghe. 4 Abschnitte(B1,B2,B3,B4) haben eingebaute Dämpfer, den letzte Abschnitt (B5) dient als Refernz.

Zusätzlich wurde die Teststrecke für die Akustischen erprobung von SD verwendet.
Es wurden track decay rates (TDR), Schienenrauheit (SR) Spektren  und Akustischen Messungen durchgeführt.

In diesem Bericht werden die Resultate der Akustische Erprobung, insbesodree die Resultate der Akustische messungen Vorgestellt und diskutiert.

**Ziel ist Wirkung von Schienenstegdämpfern Abschätzen für die Situation Niederwangen**


### Durchgeführte Messungen 

#### Abschnittnamen und eingebaute Dämpfern

Es besteht die folgende Relation zwischen Name der Abschnitten und deren eingebaute Dämpfern.

Dämpfer |ValFX/MBBM Abkürzung| EMPA Abkürzung
--------|---------------|---------------
TATA    | B1            | nicht gemessen 
S&V     | B2            | Q4 
Vossloh | B3            | Q3 
STRAIL  | B4            | Q2 
Ref     | B5            | Q1 

Es ist zu Bemerken dass die Abschnitte sind bei der Messung unterschiedlich als sonst wie im valFX Projekt benannt worden. **Ab jetzt wird die ValFX Abküzung verwendet um die Abschnitten zu unterscheiden**


#### Akustische Messung

Die Empa Abteilung Akustik/Lärmminderung wurde beauftragt, die Wirksamkeit von drei der vier Produkte anhand von Vorbeifahrts Schalldruckpegelmessungen zu ermitteln. 

Im Bericht [Messbericht Vorbeifahrtsmessungen Niederwangen](`r paste(dw_path, "Messbericht Vorbeifahrtsmessungen Niederwangen sig.pdf", sep = "")`) sind eine detallierte Beschreibung und die erste Resultate der Wirkung von SD zu sehen. (Aufpassen dass in diesem Bericht die Abschnitte anders bennant worden)

Dazu hat EMPA folgende Daten der Messung gelifert:

- Zeitsignalen ( Die Zeitsignalen sind in diesem repo nicht Verfügbar. Das benötigte Speicherplatz ist zu gross.):
    - Die Signale der Mikrophonen (in $Pa$) für jede Durchfahrt und aufjeden Abschnitt. Die Signale sind als Matlab format gelifert worden und sind ist in Ordner `/Ereignisse` gespeichert.
    - Für die Abschnitten vorgesehen mit Lichtschranken die Signalen der Lichtschranken.

-  Exceltabellen mit Informationen  jede gültige Vorbeifahrt.  Die Tabellen sind im ordner `/Tabellen` gespeichert. Diese Tabellen mit zusätzlichen Informationen sind in File `pass-by.json` überarbeitet worden um diese daten weiter verarbeiten zu können.

#### TDR Messungen

MBBM hat im Auftrag von SBB die TDR für alle Abschnitte mehrmals gemessen(vor und nach einbau von SD). Die detallierte Berichte sowohl die Daten der Messungen sind vorhanden aber nicht in diesem repo verfügbar. Die daten werden von einer lokale Datenbank abgerufen.

#### SR Messungen

SR-Spektren sind durch die firma MBBM für alle Abschnitte mehrmals gemessen nach einem schleifvorgang. Die detallierte Berichte sowohl die Daten der Messungen sind vorhanden aber nicht in diesem repo verfügbar. Die daten werden von einer lokale Datenbank abgerufen.



----

## Auswertung Aufbau

Die Auswertung besteht haupsächlich aus 2 Teilen 

1. Postprocessing von Mikrophon signalen
  Aus gemessene Signalen werden die Akustisch relevanten Grössen (Spektren Lärmniveau) berechnet.
  
2. Vergleich von Spektren TDR und SR.

### Postprocessing von Mikrophon signalen

Das postprocessing der Mikrophonsignale liefert **Terzspektren und Gesamtpegel** des Schalldruck fur jede Vorbeifahrt

Terzspektren aus den gesamte Signal oder auch Gesamtzug berechnet  werden mit `full` bezeichnet.

Für deie Abschnitte B5 und B2 würden zusätzlich die Spektren Wagenbezogen berechnet.Von wagenmitte der n-te Wagen bis zur Wagenmitte der n+1 Wagen. Diese Spektren werden mit den entsprechende Zahl `n` Bezeichnet. Das war möglich da für diese Abschnitten Lichtschrankensignalen vorhanden sind.

Zusätzliche Informationene  wurden zu jede Vorbeifahrt mithilfe von LS Signalen gewonnen:

- __Zugsgeschwindigkeit__ Nur Vorbeifahrten mit änliche Geschwindigkeit auf alle Abschnitte wurden 

- __Intevallbezeichnung__ Die Intervalle mit `n` bezeicnet (nicht Gesamtzug) können `Trieb` sowohl `Wagen` Drehgestelle enthalten. Um Intervalle aus ähnlichen Drehgestelle zu vergleichen, müssen die Intervalle jede Vorbeifahrt in `Wagen` , `Trieb/Wagen` oder `Gesamtzug (full)` kategorisiert werden.

- __Zugstyp__ Wurde mithilfe von Achsmuster und Drehgestell abstand entdeckt. Zwei klasen von Zügen sind zu unterscheiden:

    1. Regiozugen; wahrschein lich handelt sich um einen Domino (Triebwagen-Inowa-Steuerwagen) in doppelte Komposition. Triebdrehgestelle mit einen Abstand von 2.7m ergeben konsistente werte
    2. IC Zügen; diese Zügen  bestehen aus (EWIV, IC2000, Steuerwagen und Re460). Der Anzahl wagen ist variabel.
    
Im [Anhanag](#Anhang) sind die links Scripts/Dokumente der Postprocessing aufgelistet
    
### Vergleich von Spektren TDR und SR

```{r, echo=FALSE, warning=FALSE, results ='hide'}
word = params$word
if(word){
  Vorbeifahrten = knitr::knit_child("Vorbeifahrten.Rmd")
  TDR = knitr::knit_child("TDR_ni.Rmd")
  #SR = knitr::knit_child("SR_ni.Rmd")
}

```

- [Spektren von Vorbeifahrten](`r if(!word){paste( html_render, "Vorbeifahrten.html", sep = "")} `)

- [Abschätzen der Wirkung von Schienendämpfer](`r paste( html_render, "SD_wirkung.html", sep = "") `)

- [Schienenrauheiten in Niederwangen](`r paste( html_render, "SR_Ni.html", sep = "") `)

- [TDR in Niederwangen](`r paste( html_render, "TDR_Ni.html", sep = "") `)


`r if(word){paste("## Spektren von Vorbeifahrten\n", Vorbeifahrten)}`
`r if(word){paste("## TDR\n", TDR)}`
----

## Fazit

- wirkung quantifizieren
- variabilität von akustische messung. grund rauheit? zu gross um kleine unterschiede zu messen.
- die berechnete werte könnten somit zufall sein
- ruhait korrektur nich möglich sihe rauheit 

-----

## Anhang

### Berichtstruktur

Diesem Bericht besteht aus mehrere Teildokumente welche in einem [git repo](`r  repo_path`) (hosted auf GitHub.com) abgelegt sind.
Die Dokumente welche den Bericht zusammenstallen sind so aufgebaut dass Reproduzierbarkeit im Vordergrund steht, d.h Scripts und Daten (sofern möglich) auf welche die teildokumente basieren sind auch im repo zu finden.

Für die Teildokumente wurden folgende programme/frameworks verwendet:
  
- python: [python](https://de.wikipedia.org/wiki/Python_(Programmiersprache)) ist eine Programmiersprache scriptssprache welche in verschieden Kontexte verwendet wird, unter anderem für wissenschaftliche Programmierung. Die [ipython/jupyter Notebook](http://ipython.org/) (.ipynb) ermöglichen dieIntegration von  Berichterstattung und python Code (Auswertung) in einem einzigen Dokument. Für das postprocessing der Zeitsignalen wurde speziell den Modul [python-acoustics](https://github.com/python-acoustics/python-acoustics) verwendet.

- R: [R](https://www.r-project.org/) ist eine Scriptssprache mit Schwerpunkt in Statistische Berechnungen. Um Integration von Bericht und Auswertungen zu ermöglichen sind die Dokumente in .Rmd Format Aufgebaut (ich Empfehle R im Verbindung mit [Rstudio](https://www.rstudio.com/) zu verwenden).

### Postprocessing der Zeitsignalen

Aus den Zeisignalen müssen Akustischen kenngrössen berechnet werden. Das wurde mithilfe folgende Dokumente/Scripts  erreicht:

- [Darstellungen der Zeitsignalen der Mikrophone](`r paste( ipynb_render, "darstellungMicSignale.ipynb", sep = "") `)
  
- [Auswertung der Lichtschrankensignalen](`r paste( ipynb_render, "auswertungLS.ipynb", sep = "") `)

- [Spektren Berechnen](`r paste( ipynb_render, "SpektrenBerechnen.ipynb", sep = "") `)

- [Auswertung alle Vorbeifahrten](`r paste( ipynb_render,"DSPAuswertung.ipynb", sep = "") `)

Den outpout der DSP  wird in den Datensatz [results.json](DSP/results.json) gespeichert und wird dann weiter in R verwendet.
Die Dokumente/Scripts sind in ordner `DSP/` abgelegt. Es ist nicht möglich die DSP Auswertungen zu reproduzieren da die Zeitsignalen im GitHub repo nicht abgelegt sind. (Ordner zu gross). 

### R Auswetungen

Die R Auswertungen (basierend auf `.Rmd` Dokumente/Scripts) sind komplett reproduzierbar bis auf den Script `datenVorbereiten.R` welches den Datensatz [auswertungData.Rdata](auswertungData.Rdata) aus den file `DSP/results.json` und einer lokale Datenbänk zusammenstellt. 

`auswertungData.Rdata` enthät folgende Datensätze (Tabellen):

- Spektern der Vorbeifahrten, `spectWideDF`
- TDR, `TDRniWide`
- SR, `SRniWide`

### Word Output

Den Bericht wird auch als Word Dokument ([runterladen](dw/SDWirkungNiederwangen.docx)) Versuchsweise herstellt. Den Dokument ist Inhaltlich komplett jedoch nicht in seiner Form.




