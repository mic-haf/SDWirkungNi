---
output:
  github_document:
    toc: true
    toc_depth: 3
    includes:
      before_body: includes/title.html
  html_document:
    highlight: textmate
    includes:
      before_body: includes/title.html
    self_contained: yes
    theme: united
    toc: yes
  word_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 9
params:
  local: TRUE
  word: FALSE
  
---
```{r echo = F}
git_commit = "e-sr/SDWirkungNi/blob/master/"
if(params$local){
  html_render = "html/"
  ipynb_render="http://localhost:8888/notebooks/SDWirkungNi/DSP/"
}else{
  #html_render = paste("https://cdn.rawgit.com/", git_commit,sep = "")
  html_render = "https://rawgit.com/e-sr/SDWirkungNi/master/html/"
  ipynb_render = "http://nbviewer.jupyter.org/github/e-sr/SDWirkungNi/blob/master/DSP/"
}

dw_path = "https://github.com/e-sr/SDWirkungNi/raw/master/"
repo_path = "https://github.com/e-sr/SDWirkungNi/"
```
----

#### Abstract

Anlass diesem Bericht ist  die **Wirkung von Schienenstegdämpfern** abzuschätzen für die Situation Niederwangen.

----

## Einleitung 

Im Rahmen der Projekts Erprobung Schienendämpfer (SD) wurden zwischen Niederwangen und Bümplitz SD eingebaut. Diese Teststrecke dient hauptsächlich um Sicherheitsrelevanten infrastrukturseitigen Fragen zu prüfen, jedoch wurden auch Akustische Untersuchungen Durchgeführt. Die Teststrecke besteht aus 2 unterstrecken:

- Niederwangen: Betonschwelle B91,
- Bümplitz: Holzschwellen

In diesem Bericht wird nur den Teil der Teststrecke mit Betonschwellen diskutiert. Diesem Teil besteht aus 5 Abschnitten 108m länge. Vier Abschnitte (B1,B2,B3,B4) haben eingebaute Dämpfer, den letzte Abschnitt (B5) dient als Referenz. Es besteht die folgende Relation zwischen Name der Abschnitten und deren eingebaute Dämpfern.

Dämpfer |ValFX/MBBM Abkürzung| EMPA Abkürzung
--------|---------------|---------------
TATA    | B1            | nicht gemessen 
S&V     | B2            | Q4 
Vossloh | B3            | Q3 
STRAIL  | B4            | Q2 
Ref     | B5            | Q1 

Es ist zu Bemerken dass die Abschnitte sind werden je Messung unterschiedlich benannt. In diesem Bericht wird die *MBBM Abküzung verwendet* um die Abschnitten zu unterscheiden.

----

## Durchgeführte Messungen

In Niederwangen wurden track decay rates (TDR), Schienenrauheiten (SR)  und Akustischen Messungen durchgeführt.

1. **Akustische Messung**

    Die Empa Abteilung Akustik/Lärmminderung wurde beauftragt, die Wirksamkeit von drei der vier Produkte anhand von Vorbeifahrts Schalldruckpegelmessungen zu ermitteln. Im Bericht [Messbericht Vorbeifahrtsmessungen Niederwangen](`r paste(dw_path, "Messbericht Vorbeifahrtsmessungen Niederwangen sig.pdf", sep = "")`) sind eine detallierte Beschreibung und die erste Resultate der Wirkung von SD zu sehen. Dazu hat EMPA die rohe Daten der Messung gelifert, daraus wurden Schallpegeln und Spektren  für unterschiedliche Auswertungsintervalle Berechnet.
    
2. **TDR Messungen**

    MBBM hat im Auftrag von SBB die TDR für alle Abschnitte mehrmals gemessen(vor und nach einbau von SD). Die detallierte Berichte sowohl die Daten der Messungen sind vorhanden aber nicht in diesem repo verfügbar. Die daten werden von einer lokale Datenbank abgerufen.

3. **SR Messungen**
    
    SR sind durch die Firma MBBM für alle Abschnitte mehrmals gemessen nach einem Schleifvorgang. Die detaillierte Berichte sowohl die Daten der Messungen sind vorhanden aber nicht in diesem Repo verfügbar. Die Daten werden von einer lokale Datenbank abgerufen.

----

```{r, results='hide',echo=FALSE}
word = F #params$word
if(word){
  Vorbeifahrten = knitr::knit_child("Vorbeifahrten.Rmd")
  TDR = knitr::knit_child("TDR_ni.Rmd")
  #SR = knitr::knit_child("SR_ni.Rmd")
}  

#`r if(word){paste("## Spektren von Vorbeifahrten\n", Vorbeifahrten)}`
#`r if(word){paste("## TDR\n", TDR)}`

```   

## Analyse von Messungen

### Akustische Messung

Das Processing der Mikrophonsignale liefert **Schallpegel und Terzspektren** des Schalldruck für jede Vorbeifahrt welche dann weiter in der Auswertung verwendet werden. Schallpegeln und Spektren  sind in **dBA** angegeben. 

Die berechnete Schallpegeln und Spektren entsprechen die  energetisch gemittelte Werte über einen bestimmtes Intervall für unterschiedliche Auswertung Intervalle:

- *Schallpegeln und Spektren  aus den gesamte Durchfahrt berechnet.* Werden mit `full` bezeichnet.
- *Schallpegeln und Spektren  Wagenweise ausgewertet.* Für die Abschnitte B5 und B2 (Abschnitten mit Lichtschrankensignalen) würden zusätzlich die Schallpegeln und Spektren Wagen-bezogen berechnet. Von Wagenmitte der n-te Wagen bis zur Wagenmitte der n+1 Wagen. Diese Spektren werden mit den entsprechende Wagennummer `n` Bezeichnet.

Zusätzlich konnten weitere Informationen mithilfe von LS Signalen gewonnen werden:

- *Zugsgeschwindigkeit.* Nur Vorbeifahrten mit ähnliche Geschwindigkeit auf alle Abschnitte werden berücksichtigt.
- *Zugstyp.*  Zwei klassen von Zügen sind zu unterscheiden:
    1. Regiozügen; handelt sich um einen Domino (Triebwagen-Inowa-Steuerwagen) in doppelte Komposition 
    (Triebdrehgestelle mit einen Abstand von 2.7m ergeben konsistente werte)
    2. IC Zügen; diese Zügen  bestehen aus (EWIV, IC2000, Steuerwagen und Re460). Der Anzahl wagen ist variabel.
  Zugtyp wurde mithilfe aus Achs-muster und Achsabstand entdeckt.
- *Wagentyp.* Die Wagen-bezogenen Schallpegeln und Spektren (mit `n` bezeichnet) können `Trieb` sowohl `Wagen` Drehgestelle enthalten. Um Wagen-bezogenen  Schallpegeln und Spektren aus ähnlichen Drehgestelle zu vergleichen, werden die Intervalle jede Vorbeifahrt in `Wagen` , `Trieb/Wagen` kategorisiert. Die Kategorisierung erfolgt mithilfe von Achsabstand.

Im Anhang sind weitere Details zur Postprocessing zu finden. 

**Aus Schallpegel und Spektren werden folgenden Auswertungen durchgeführt:**

- [**Schallpegel und Spektren, erste Darstellungen**](`r if(!word){paste( html_render, "Vorbeifahrten.html", sep = "")} `) um einen Gefühl mit die gemessene/ausgewertete Werte zu bekommen.
    
- [**Abschätzen der  SD Wirkung**](`r paste( html_render, "SD_wirkung.html", sep = "") `). Die Pegeldifferenz zwischen Referenzabschnitt und Dämpferabschnitt  wird berechnet und diskutiert.
    
### SR 

Im [**Auswertungsteil Schienenrauheiten in Niederwangen**](`r paste( html_render, "SR_Ni.html", sep = "") `) werden die SR in Niederwangen in Zusammenhang mit die Akustische Messung diskutiert. Vergleichbarkeit der Abschnitte bezüglich SR und mögliche Korrekturen anhand SR stehen in Vordergrund 
    
### TDR 

Im [**Auswertungsteil TDR in Niederwangen**](`r paste( html_render, "TDR_Ni.html", sep = "") `) untersucht die Konsistenz der gemessene SD Wirkung mit die gemessene TDR.


----

## Fazit



- Wirkung quantifizieren
- Variabilität von akustische Messung. Grund Rauheit? zu groß um kleine unterscheide zu messen.
- die berechnete werte könnten somit Zufall sein
- Ruhezeit  mich möglich siehe Rauheit 

-----

## Anhang

### Berichtsform  

Diesem Bericht besteht aus mehrere Teildokumente welche in einem [git repo](`r  repo_path`) (hosted auf GitHub.com) abgelegt sind.
Die Dokumente welche den Bericht zusammenstallen sind so aufgebaut dass Reproduzierbarkeit im Vordergrund steht, d.h Scripts und Daten (sofern möglich) auf welche die Teildokumente basieren sind auch im Repo zu finden.

Für die Teildokumente wurden folgende Programme verwendet:
  
- Python: [python](https://de.wikipedia.org/wiki/Python_(Programmiersprache)) ist eine Programmiersprache welche in verschieden Kontexte verwendet wird, unter anderem für wissenschaftliche Programmierung. Die [ipython/jupyter Notebook](http://ipython.org/) (.ipynb) ermöglichen die Integration von  Berichterstattung und Python Code (Auswertung) in einem einzigen Dokument. Für das Processing der Zeitsignalen wurde speziell den Modul [python-acoustics](https://github.com/python-acoustics/python-acoustics) verwendet.

- R: [R](https://www.r-project.org/) ist eine Scriptsprache mit Schwerpunkt in Statistische Berechnungen. Um Integration von Bericht und Auswertungen zu ermöglichen sind die Dokumente in .Rmd Format Aufgebaut (ich Empfehle R im Verbindung mit [Rstudio](https://www.rstudio.com/) zu verwenden).

### Dokumente, Scripts und Daten zur Postprocessing der Zeitsignalen

Die EMPA hat folgende Daten der Messung geliefert:

- *Zeitsignalen* ( Die Zeitsignalen sind in diesem Repo nicht Verfügbar. Das benötigte Speicherplatz ist zu gross.):
    - Die Signale der Mikrophonen (in $Pa$) für jede Durchfahrt und auf jeden Abschnitt. Die Signale sind als Matlab Format geliefert worden und sind ist in Ordner `/Ereignisse` gespeichert.
    - Für die Abschnitten vorgesehen mit Lichtschranken die Signalen der Lichtschranken.
-  *Exceltabellen* mit Informationen  jede gültige Vorbeifahrt.  Die Tabellen sind im Ordner `/Tabellen` gespeichert. Diese Tabellen mit zusätzlichen Informationen sind in File `pass-by.json` überarbeitet worden um diese Daten weiter verarbeiten zu können.

Aus den Zeitsignalen werden **Schallpegel und Terzspektren** des Schalldruck und zusätzlichen Informationen berechnet. Das erfolgt mit die folgende Dokumente/Scripts:

- [Darstellungen der Zeitsignalen der Mikrophone](`r paste( ipynb_render, "darstellungMicSignale.ipynb", sep = "") `)
  
- [Auswertung der Lichtschrankensignalen](`r paste( ipynb_render, "auswertungLS.ipynb", sep = "") `)

- [Schallpegeln und Spektren Berechnen](`r paste( ipynb_render, "SpektrenBerechnen.ipynb", sep = "") `)

- [Auswertung alle Vorbeifahrten](`r paste( ipynb_render,"DSPAuswertung.ipynb", sep = "") `)

Den Output der DSP  wird in den Datensatz [results.json](DSP/results.json) gespeichert und wird dann weiter in R verwendet.
Die Dokumente/Scripts sind in Ordner `DSP/` abgelegt. Es ist nicht möglich die DSP Auswertungen zu reproduzieren da die Zeitsignalen im GitHub Repo nicht abgelegt sind. (Ordner zu gross). 

### Dokumente, Scripts und Daten zur Analyse der Messungen 

Die Analyse der Messungen (basierend auf `.Rmd` Dokumente/Scripts mit selbsterklärende Name) sind komplett reproduzierbar bis auf den Script `datenVorbereiten.R` welches den Datensatz [auswertungData.Rdata](auswertungData.Rdata) aus den File `DSP/results.json` und aus einer lokale Datenbank zusammenstellt. 

`auswertungData.Rdata` enthält folgende Datensätze (Tabellen):

- Shallpegeln und Spektren der Vorbeifahrten, `spectWideDF`
- TDR, `TDRniWide`
- SR, `SRniWide`

### Word Output

Den Bericht wird auch als Word Dokument ([runterladen](dw/SDWirkungNiederwangen.docx)) Versuchsweise herstellt. Den Dokument ist Inhaltlich komplett jedoch nicht in seiner Form.




